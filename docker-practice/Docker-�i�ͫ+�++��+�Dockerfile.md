#centos7安装docker 
    yum install dockerWarning
    systemctl stop firewalld 
    systemctl disable firewalld
    systemctl start docker; systemctl enable docker
注意使用docker时要关闭防火墙和selinux


##下载docker file 学习资料

` git clone https://github.com/nicescale/docker-training.git `

# 使用docker file 部署一个 centos7.2 

常见docker fire 指令说明
    
    #
    # MAINTAINERCarson,C.J.Zeong <zcy@nicescale.com>
    # DOCKER-VERSION1.6.2
    #
    # Dockerizing CentOS7: Dockerfile for building CentOS images
    #
    FROM   centos:centos7.2.1511
    MAINTAINER Carson,C.J.Zeong <zcy@nicescale.com>
    
    ENV TZ "Asia/Shanghai"
    ENV TERM xterm
    
    ADD aliyun-mirror.repo /etc/yum.repos.d/CentOS-Base.repo
    ADD aliyun-epel.repo /etc/yum.repos.d/epel.repo
    
    RUN yum install -y curl wget tar bzip2 unzip vim-enhanced passwd sudo yum-utils hostname net-tools rsync man && \
    yum install -y gcc gcc-c++ git make automake cmake patch logrotate python-devel libpng-devel libjpeg-devel && \
    yum install -y --enablerepo=epel pwgen python-pip && \
    yum clean all
    
    RUN pip install supervisor
    ADD supervisord.conf /etc/supervisord.conf
    
    RUN mkdir -p /etc/supervisor.conf.d && \
    mkdir -p /var/log/supervisor
    
    EXPOSE 22
    
    ENTRYPOINT ["/usr/bin/supervisord", "-n", "-c", "/etc/supervisord.conf"]

1. FORM 父镜像地址
2. ADD 复制指令
2. RUN 执行bash指令 
3. EXPOSE 22 允许宿主机访问容器22端口

# 构建cenots7.1 docker 镜像
    docker build -t image_name Dockerfile_path
    build
      --no-cache=false Do not use cache when building the image
      -q, --quiet=false Suppress the verbose output generated by the containers
      --rm=true Remove intermediate containers after a successful build
      -t, --tag="" Repository name (and optionally a tag) to be applied to the resulting image in case of success

    EX:docker build -t csphere/centos:7.1 /root/docker-training/first/centos7

#启动容器（run）

docker容器可以理解为在沙盒中运行的进程。这个沙盒包含了该进程运行所必须的资源，包括文件系统、系统类库、shell 环境等等。但这个沙盒默认是不会运行任何程序的。你需要在沙盒中运行一个进程来启动某一个容器。这个进程是该容器的唯一进程，所以当该进程结束的时候，容器也会完全的停止。

    # 在容器中运行"echo"命令，输出"hello word"
    $docker run image_name echo "hello word"
    
    # 交互式进入容器中
    $docker run -i -t image_name /bin/bash
    # 以守护进程方式运行
    # docker run -d -p 2222:22 --name base csphere/centos:7.1
    # 在容器中安装新的程序
    $docker run image_name apt-get install -y app_name

#查看容器（ps）

    # 列出当前所有正在运行的container
    $docker ps
    # 列出所有的container
    $docker ps -a
    # 列出最近一次启动的container
    $docker ps -l

#构建php-fpm docker file 镜像

    #
    # MAINTAINERCarson,C.J.Zeong <zcy@nicescale.com>
    # DOCKER-VERSION1.6.2
    #
    # Dockerizing php-fpm: Dockerfile for building php-fpm images
    #
    FROM   csphere/centos:7.1
    MAINTAINER Carson,C.J.Zeong <zcy@nicescale.com>
    
    # Set environment variable
    ENV	APP_DIR /app
    
    RUN	yum -y install nginx php-cli php-mysql php-pear php-ldap php-mbstring php-soap php-dom php-gd php-xmlrpc php-fpm php-mcrypt && \ 
    	yum clean all
    
    ADD nginx_nginx.conf /etc/nginx/nginx.conf
    ADD	nginx_default.conf /etc/nginx/conf.d/default.conf
    
    ADD	php_www.conf /etc/php-fpm.d/www.conf
    RUN	sed -i 's/;cgi.fix_pathinfo=1/cgi.fix_pathinfo=0/' /etc/php.ini
    
    RUN	mkdir -p /app && echo "<?php phpinfo(); ?>" > ${APP_DIR}/info.php
    
    EXPOSE	80 443
    
    ADD	supervisor_nginx.conf /etc/supervisor.conf.d/nginx.conf
    ADD	supervisor_php-fpm.conf /etc/supervisor.conf.d/php-fpm.conf
    
    ONBUILD ADD . /app
    ONBUILD RUN chown -R nginx:nginx /app